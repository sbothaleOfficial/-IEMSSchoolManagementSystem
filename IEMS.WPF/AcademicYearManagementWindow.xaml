<Window x:Class="IEMS.WPF.AcademicYearManagementWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Academic Year Management" Height="700" Width="1100"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundBrush}">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header Section -->
        <Border Grid.Row="0" Background="{StaticResource PrimaryBrush}" Padding="20">
            <StackPanel>
                <TextBlock Text="ðŸ“… Academic Year Management"
                           FontSize="24" FontWeight="Bold"
                           Foreground="{StaticResource TextOnPrimaryBrush}"/>
                <TextBlock Text="Manage academic years for your school"
                           FontSize="13" Margin="0,5,0,0"
                           Foreground="{StaticResource PrimaryLightBrush}"/>
            </StackPanel>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="20"/>
                <ColumnDefinition Width="1.2*"/>
            </Grid.ColumnDefinitions>

            <!-- Left: Academic Years List -->
            <Border Grid.Column="0" Style="{StaticResource CardStyle}" Padding="15">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Toolbar -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,15">
                        <Button x:Name="btnAdd" Content="âž• Add New Year"
                                Style="{StaticResource SuccessButtonStyle}"
                                Click="BtnAdd_Click"
                                Width="150" Margin="0,0,10,0"/>
                        <Button x:Name="btnRefresh" Content="ðŸ”„ Refresh"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Click="BtnRefresh_Click"
                                Width="100"/>
                    </StackPanel>

                    <!-- DataGrid -->
                    <DataGrid x:Name="dgAcademicYears"
                              Grid.Row="1"
                              Style="{StaticResource ModernDataGridStyle}"
                              SelectionChanged="DgAcademicYears_SelectionChanged"
                              MouseDoubleClick="DgAcademicYears_MouseDoubleClick">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Year" Binding="{Binding Year}" Width="100"/>
                            <DataGridTextColumn Header="Start Date" Binding="{Binding StartDate, StringFormat='{}{0:dd/MM/yyyy}'}" Width="120"/>
                            <DataGridTextColumn Header="End Date" Binding="{Binding EndDate, StringFormat='{}{0:dd/MM/yyyy}'}" Width="120"/>
                            <DataGridTemplateColumn Header="Status" Width="100">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border Background="{Binding IsCurrent, Converter={StaticResource CurrentStatusConverter}}"
                                                CornerRadius="4" Padding="8,4"
                                                HorizontalAlignment="Center">
                                            <TextBlock Text="{Binding IsCurrent, Converter={StaticResource CurrentStatusTextConverter}}"
                                                       Foreground="White"
                                                       FontWeight="SemiBold"
                                                       FontSize="11"/>
                                        </Border>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="Actions" Width="*">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button Content="âœï¸ Edit"
                                                    Style="{StaticResource PrimaryButtonStyle}"
                                                    Click="BtnEdit_Click"
                                                    Tag="{Binding}"
                                                    Width="70" Height="28" Margin="2"
                                                    FontSize="11" Padding="5,3"/>
                                            <Button Content="â­ Set Current"
                                                    Style="{StaticResource WarningButtonStyle}"
                                                    Click="BtnSetCurrent_Click"
                                                    Tag="{Binding}"
                                                    Width="90" Height="28" Margin="2"
                                                    FontSize="11" Padding="5,3"
                                                    Visibility="{Binding IsCurrent, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                                            <Button Content="ðŸ—‘ï¸ Delete"
                                                    Style="{StaticResource DangerButtonStyle}"
                                                    Click="BtnDelete_Click"
                                                    Tag="{Binding}"
                                                    Width="70" Height="28" Margin="2"
                                                    FontSize="11" Padding="5,3"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </Border>

            <!-- Right: Add/Edit Form -->
            <Border Grid.Column="2" Style="{StaticResource CardStyle}" Padding="15">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Form Header -->
                    <TextBlock x:Name="lblFormTitle" Text="Add New Academic Year"
                               FontSize="18" FontWeight="Bold"
                               Foreground="{StaticResource PrimaryBrush}"
                               Margin="0,0,0,20"/>

                    <!-- Form -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <!-- Year Field -->
                            <TextBlock Text="Academic Year *" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <TextBox x:Name="txtYear" Style="{StaticResource ModernTextBoxStyle}"
                                     Margin="0,0,0,15"
                                     TextChanged="TxtYear_TextChanged"/>
                            <TextBlock x:Name="lblYearHelper" Text="Format: YYYY-YY (e.g., 2024-25)"
                                       FontSize="11" Foreground="{StaticResource TextMutedBrush}"
                                       Margin="0,-12,0,15"/>

                            <!-- Start Date -->
                            <TextBlock Text="Start Date *" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <DatePicker x:Name="dpStartDate" Style="{StaticResource ModernDatePickerStyle}"
                                        Margin="0,0,0,15"
                                        SelectedDateChanged="DpStartDate_SelectedDateChanged"/>

                            <!-- End Date -->
                            <TextBlock Text="End Date *" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <DatePicker x:Name="dpEndDate" Style="{StaticResource ModernDatePickerStyle}"
                                        Margin="0,0,0,15"/>

                            <!-- Is Current Checkbox -->
                            <CheckBox x:Name="chkIsCurrent" Content="Set as Current Academic Year"
                                      Style="{StaticResource ModernCheckBoxStyle}"
                                      Margin="0,0,0,20"/>

                            <!-- Validation Message -->
                            <Border x:Name="pnlValidationMessage"
                                    Background="{StaticResource DangerLightBrush}"
                                    BorderBrush="{StaticResource DangerBrush}"
                                    BorderThickness="1" CornerRadius="4"
                                    Padding="10" Margin="0,0,0,15"
                                    Visibility="Collapsed">
                                <TextBlock x:Name="lblValidationMessage"
                                           Foreground="{StaticResource DangerBrush}"
                                           TextWrapping="Wrap"
                                           FontSize="12"/>
                            </Border>

                            <!-- Action Buttons -->
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch" Margin="0,10,0,0">
                                <Button x:Name="btnSave" Content="ðŸ’¾ Save"
                                        Style="{StaticResource SuccessButtonStyle}"
                                        Click="BtnSave_Click"
                                        Width="120" Margin="0,0,10,0"/>
                                <Button x:Name="btnCancel" Content="âŒ Cancel"
                                        Style="{StaticResource SecondaryButtonStyle}"
                                        Click="BtnCancel_Click"
                                        Width="100"/>
                            </StackPanel>

                            <!-- Info Panel -->
                            <Border Background="{StaticResource InfoLightBrush}"
                                    BorderBrush="{StaticResource InfoBrush}"
                                    BorderThickness="1" CornerRadius="4"
                                    Padding="10" Margin="0,20,0,0">
                                <StackPanel>
                                    <TextBlock Text="â„¹ï¸ Tips" FontWeight="Bold"
                                               Foreground="{StaticResource InfoBrush}"
                                               Margin="0,0,0,5"/>
                                    <TextBlock Text="â€¢ Year format must be YYYY-YY"
                                               FontSize="11" TextWrapping="Wrap"
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                    <TextBlock Text="â€¢ Only one year can be current"
                                               FontSize="11" TextWrapping="Wrap"
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                    <TextBlock Text="â€¢ Duration must be 9-15 months"
                                               FontSize="11" TextWrapping="Wrap"
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                    <TextBlock Text="â€¢ Double-click a row to edit"
                                               FontSize="11" TextWrapping="Wrap"
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2" Background="{StaticResource SurfaceBrush}"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0"
                Padding="20,10">
            <TextBlock x:Name="lblStatus" Text="Ready"
                       Foreground="{StaticResource TextSecondaryBrush}"
                       FontSize="12"/>
        </Border>

        <!-- Loading Overlay -->
        <Grid x:Name="LoadingOverlay" Grid.RowSpan="3"
              Background="#80000000" Visibility="Collapsed">
            <Border Background="White" CornerRadius="8"
                    Width="200" Height="100"
                    HorizontalAlignment="Center" VerticalAlignment="Center">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <TextBlock Text="â³" FontSize="32" HorizontalAlignment="Center"/>
                    <TextBlock Text="Loading..." FontSize="14"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               HorizontalAlignment="Center" Margin="0,10,0,0"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Window>
