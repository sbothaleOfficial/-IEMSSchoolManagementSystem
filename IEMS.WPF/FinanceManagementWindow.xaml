<Window x:Class="IEMS.WPF.FinanceManagementWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Finance Management" Height="800" Width="1400"
        WindowStartupLocation="CenterScreen">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{StaticResource PrimaryBrush}" Height="80" Padding="20,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Button x:Name="btnBack" Content="← Back"
                            Click="BtnBack_Click"
                            Style="{StaticResource SecondaryButtonStyle}"
                            Width="80" Height="32" Margin="0,0,20,0"/>
                    <TextBlock Text="Finance Management &amp; Analytics"
                               FontSize="24" FontWeight="Bold"
                               Foreground="{StaticResource TextOnPrimaryBrush}"
                               VerticalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Academic Year:" Foreground="{StaticResource TextOnPrimaryBrush}" Margin="0,0,10,0"/>
                    <ComboBox x:Name="cmbAcademicYear" Width="120" Height="30"
                              SelectionChanged="CmbAcademicYear_SelectionChanged"/>
                    <Button x:Name="btnRefreshAnalytics" Content="🔄 Refresh"
                            Click="BtnRefreshAnalytics_Click"
                            Style="{StaticResource SecondaryButtonStyle}"
                            Width="80" Height="30" Margin="10,0,0,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Tab Control -->
        <TabControl Grid.Row="1" Margin="10">
            <TabControl.Resources>
                <Style TargetType="TabItem">
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="TabItem">
                                <Border Name="Border" Background="{StaticResource SurfaceBrush}"
                                        BorderBrush="{StaticResource BorderBrush}"
                                        BorderThickness="1,1,1,0"
                                        CornerRadius="4,4,0,0"
                                        Margin="2,0">
                                    <ContentPresenter x:Name="ContentSite"
                                                    VerticalAlignment="Center"
                                                    HorizontalAlignment="Center"
                                                    ContentSource="Header"
                                                    Margin="12,8"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter TargetName="Border" Property="Background" Value="{StaticResource PrimaryBrush}"/>
                                        <Setter Property="Foreground" Value="{StaticResource TextOnPrimaryBrush}"/>
                                    </Trigger>
                                    <Trigger Property="IsSelected" Value="False">
                                        <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="FontSize" Value="14"/>
                    <Setter Property="FontWeight" Value="SemiBold"/>
                </Style>
            </TabControl.Resources>

            <!-- Dashboard Tab -->
            <TabItem Header="Dashboard" Name="DashboardTab">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="20">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Summary Cards -->
                        <UniformGrid Grid.Row="0" Columns="4" Margin="0,0,0,20">
                            <Border Style="{StaticResource CardStyle}" Margin="5" Background="#E8F5E9">
                                <StackPanel>
                                    <TextBlock Text="Total Collection" FontSize="12" Foreground="Gray"/>
                                    <TextBlock x:Name="txtTotalCollection" Text="₹0"
                                               FontSize="24" FontWeight="Bold" Foreground="#2E7D32"/>
                                    <TextBlock x:Name="txtCollectionSubtext" Text="This Academic Year"
                                               FontSize="10" Foreground="Gray"/>
                                </StackPanel>
                            </Border>

                            <Border Style="{StaticResource CardStyle}" Margin="5" Background="#FFF3E0">
                                <StackPanel>
                                    <TextBlock Text="Pending Fees" FontSize="12" Foreground="Gray"/>
                                    <TextBlock x:Name="txtPendingFees" Text="₹0"
                                               FontSize="24" FontWeight="Bold" Foreground="#E65100"/>
                                    <TextBlock x:Name="txtPendingSubtext" Text="Outstanding Amount"
                                               FontSize="10" Foreground="Gray"/>
                                </StackPanel>
                            </Border>

                            <Border Style="{StaticResource CardStyle}" Margin="5" Background="#E3F2FD">
                                <StackPanel>
                                    <TextBlock Text="Students with Pending" FontSize="12" Foreground="Gray"/>
                                    <TextBlock x:Name="txtStudentsWithPending" Text="0"
                                               FontSize="24" FontWeight="Bold" Foreground="#0D47A1"/>
                                    <TextBlock x:Name="txtStudentsSubtext" Text="Need to Pay"
                                               FontSize="10" Foreground="Gray"/>
                                </StackPanel>
                            </Border>

                            <Border Style="{StaticResource CardStyle}" Margin="5" Background="#F3E5F5">
                                <StackPanel>
                                    <TextBlock Text="Collection Rate" FontSize="12" Foreground="Gray"/>
                                    <TextBlock x:Name="txtCollectionRate" Text="0%"
                                               FontSize="24" FontWeight="Bold" Foreground="#7B1FA2"/>
                                    <TextBlock x:Name="txtRateSubtext" Text="Fee Completion"
                                               FontSize="10" Foreground="Gray"/>
                                </StackPanel>
                            </Border>
                        </UniformGrid>

                        <!-- Monthly Trend Chart -->
                        <Border Grid.Row="1" Style="{StaticResource CardStyle}" Margin="0,0,0,20" Height="250">
                            <StackPanel>
                                <TextBlock Text="Monthly Collection Trend" FontSize="16" FontWeight="Bold" Margin="10"/>
                                <DataGrid x:Name="dgMonthlyTrend" AutoGenerateColumns="False" Height="200"
                                          HeadersVisibility="Column" GridLinesVisibility="Horizontal"
                                          AlternatingRowBackground="#F5F5F5" Margin="10">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Month" Binding="{Binding MonthName}" Width="150"/>
                                        <DataGridTextColumn Header="Total Collection" Binding="{Binding TotalCollection, StringFormat=₹{0:N2}}" Width="150"/>
                                        <DataGridTextColumn Header="No. of Payments" Binding="{Binding NumberOfPayments}" Width="120"/>
                                        <DataGridTextColumn Header="Average Payment" Binding="{Binding AveragePaymentAmount, StringFormat=₹{0:N2}}" Width="*"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </Border>

                        <!-- Fee Type Analytics -->
                        <Border Grid.Row="2" Style="{StaticResource CardStyle}" Margin="0,0,0,20" Height="250">
                            <StackPanel>
                                <TextBlock Text="Fee Type Analytics" FontSize="16" FontWeight="Bold" Margin="10"/>
                                <DataGrid x:Name="dgFeeTypeAnalytics" AutoGenerateColumns="False" Height="200"
                                          HeadersVisibility="Column" GridLinesVisibility="Horizontal"
                                          AlternatingRowBackground="#F5F5F5" Margin="10">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Fee Type" Binding="{Binding FeeTypeName}" Width="150"/>
                                        <DataGridTextColumn Header="Collected" Binding="{Binding TotalCollected, StringFormat=₹{0:N2}}" Width="120"/>
                                        <DataGridTextColumn Header="Pending" Binding="{Binding TotalPending, StringFormat=₹{0:N2}}" Width="120"/>
                                        <DataGridTextColumn Header="Students with Pending" Binding="{Binding StudentsWithPending}" Width="150"/>
                                        <DataGridTextColumn Header="Collection Rate" Binding="{Binding CollectionRate, StringFormat={}{0:F1}%}" Width="*"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </Border>
                    </Grid>
                </ScrollViewer>
            </TabItem>

            <!-- Fee Analytics Tab (Read-only) -->
            <TabItem Header="📊 Fee Analytics">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="20">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Navigation Header -->
                        <Border Grid.Row="0" Background="{StaticResource InfoLightBrush}"
                                BorderBrush="{StaticResource InfoBrush}"
                                BorderThickness="1" Padding="15" Margin="0,0,0,20" CornerRadius="5">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Fee Analytics &amp; Reports" FontSize="18" FontWeight="Bold"
                                               Foreground="{StaticResource InfoBrush}"/>
                                    <TextBlock Text="View fee collection statistics and pending fee reports. For fee collection operations, go to Student Management."
                                               FontSize="12" Foreground="{StaticResource TextSecondaryBrush}"
                                               TextWrapping="Wrap" Margin="0,5,0,0"/>
                                </StackPanel>

                                <Button Grid.Column="1" x:Name="btnGoToStudentManagement"
                                        Content="Go to Student Management →"
                                        Click="BtnGoToStudentManagement_Click"
                                        Style="{StaticResource PrimaryButtonStyle}"
                                        Height="40" Padding="20,0" VerticalAlignment="Center"/>
                            </Grid>
                        </Border>

                        <!-- Recent Fee Payments Section -->
                        <TextBlock Grid.Row="1" Text="Recent Fee Payments (Last 30 days)" FontSize="16" FontWeight="Bold"
                                   Margin="0,10,0,10"/>

                        <Border Grid.Row="2" Style="{StaticResource CardStyle}" Height="200" Margin="0,0,0,20">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Right" Margin="5">
                                    <TextBlock Text="From:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                    <DatePicker x:Name="dpFeeFromDate" Width="120" Height="25" Margin="0,0,5,0" FontSize="11"/>
                                    <TextBlock Text="To:" VerticalAlignment="Center" Margin="5,0"/>
                                    <DatePicker x:Name="dpFeeToDate" Width="120" Height="25" Margin="5,0,10,0" FontSize="11"/>
                                    <Button Content="Refresh" Width="60" Height="25" Click="BtnApplyFeeFilter_Click" FontSize="11"/>
                                </StackPanel>

                                <DataGrid Grid.Row="1" x:Name="dgFeePayments"
                                          AutoGenerateColumns="False"
                                          CanUserAddRows="False"
                                          IsReadOnly="True"
                                          SelectionMode="Single"
                                          GridLinesVisibility="Horizontal"
                                          HeadersVisibility="Column"
                                          AlternatingRowBackground="#F5F5F5">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Receipt No" Binding="{Binding ReceiptNumber}" Width="90"/>
                                        <DataGridTextColumn Header="Date" Binding="{Binding PaymentDate, StringFormat=dd/MM/yyyy}" Width="90"/>
                                        <DataGridTextColumn Header="Student" Binding="{Binding StudentName}" Width="180"/>
                                        <DataGridTextColumn Header="Class" Binding="{Binding ClassName}" Width="100"/>
                                        <DataGridTextColumn Header="Fee Type" Binding="{Binding FeeType}" Width="100"/>
                                        <DataGridTextColumn Header="Amount" Binding="{Binding AmountPaid, StringFormat=₹{0:N2}}" Width="90"/>
                                        <DataGridTextColumn Header="Mode" Binding="{Binding PaymentMethod}" Width="80"/>
                                        <DataGridTextColumn Header="Balance" Binding="{Binding RemainingBalance, StringFormat=₹{0:N2}}" Width="*"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </Border>

                        <!-- Class-wise Analysis -->
                        <TextBlock Grid.Row="3" Text="Class-wise Fee Analysis" FontSize="16" FontWeight="Bold"
                                   Margin="0,10,0,10"/>

                        <Border Grid.Row="4" Style="{StaticResource CardStyle}" Height="250" Margin="0,0,0,20">
                            <DataGrid x:Name="dgClassWiseAnalysis" AutoGenerateColumns="False"
                                      IsReadOnly="True"
                                      HeadersVisibility="Column" GridLinesVisibility="Horizontal"
                                      AlternatingRowBackground="#F5F5F5">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Class" Binding="{Binding ClassName}" Width="100"/>
                                    <DataGridTextColumn Header="Section" Binding="{Binding Section}" Width="80"/>
                                    <DataGridTextColumn Header="Total Students" Binding="{Binding TotalStudents}" Width="100"/>
                                    <DataGridTextColumn Header="Students with Pending" Binding="{Binding StudentsWithPendingFees}" Width="150"/>
                                    <DataGridTextColumn Header="Total Pending Amount" Binding="{Binding TotalPendingAmount, StringFormat=₹{0:N2}}" Width="150"/>
                                    <DataGridTextColumn Header="Avg Pending per Student" Binding="{Binding AveragePendingPerStudent, StringFormat=₹{0:N2}}" Width="150"/>
                                    <DataGridTextColumn Header="Collection %" Binding="{Binding CollectionPercentage, StringFormat={}{0:F1}%}" Width="*"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </Border>

                        <!-- Pending Fees Section -->
                        <Grid Grid.Row="5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Orientation="Horizontal">
                                <TextBlock Text="Students with Pending Fees" FontSize="16" FontWeight="Bold"
                                           VerticalAlignment="Center" Margin="0,10,20,10"/>
                                <TextBlock Text="Filter by Class:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <ComboBox x:Name="cmbClassFilter" Width="150" Height="30"
                                          SelectionChanged="CmbClassFilter_SelectionChanged"
                                          VerticalAlignment="Center">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Name}"/>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <Button x:Name="btnExportPendingFees" Content="📤 Export to Excel"
                                        Click="BtnExportPendingFees_Click"
                                        Style="{StaticResource SecondaryButtonStyle}"
                                        Width="130" Height="30" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <Button x:Name="btnCollectFeesNav" Content="💰 Collect Fees"
                                        Click="BtnGoToStudentManagement_Click"
                                        Style="{StaticResource SuccessButtonStyle}"
                                        Width="130" Height="30" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Grid>

                        <Border Grid.Row="6" Style="{StaticResource CardStyle}" MinHeight="200" Margin="0,0,0,20">
                            <DataGrid x:Name="dgPendingFees" AutoGenerateColumns="False"
                                      IsReadOnly="True"
                                      HeadersVisibility="Column" GridLinesVisibility="Horizontal"
                                      AlternatingRowBackground="#F5F5F5">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Student Name" Binding="{Binding StudentName}" Width="200"/>
                                    <DataGridTextColumn Header="Class" Binding="{Binding ClassName}" Width="120"/>
                                    <DataGridTextColumn Header="Student No." Binding="{Binding StudentNumber}" Width="100"/>
                                    <DataGridTextColumn Header="Parent Phone" Binding="{Binding ParentPhone}" Width="120"/>
                                    <DataGridTextColumn Header="Total Pending" Binding="{Binding TotalPendingAmount, StringFormat=₹{0:N2}}" Width="120"/>
                                    <DataGridTextColumn Header="Last Payment" Binding="{Binding LastPaymentDate, StringFormat=dd/MM/yyyy}" Width="100"/>
                                    <DataGridTextColumn Header="Days Overdue" Binding="{Binding DaysSinceLastPayment}" Width="*"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </Border>
                    </Grid>
                </ScrollViewer>
            </TabItem>

            <!-- Expense Management Tab -->
            <!-- Electricity Bills Tab -->
            <TabItem Header="🔌 Electricity Bills">
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Electricity Bills Header -->
                    <Grid Grid.Row="0" Margin="0,0,0,20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Electricity Bills Management" FontSize="20" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>
                            <TextBlock Text="Track monthly electricity bills, units consumed and payment status" FontSize="12" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,5,0,0"/>
                        </StackPanel>

                        <Button Grid.Column="1" x:Name="btnAddElectricityBill" Content="+ Add New Bill"
                                Height="35" Padding="15,0" Click="BtnAddElectricityBill_Click"
                                Style="{StaticResource PrimaryButtonStyle}"/>
                    </Grid>

                    <!-- Electricity Bills DataGrid -->
                    <DataGrid Grid.Row="1" x:Name="dgElectricityBills"
                              AutoGenerateColumns="False" CanUserAddRows="False"
                              MouseDoubleClick="DgElectricityBills_MouseDoubleClick">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Bill Number" Binding="{Binding BillNumber}" Width="120"/>
                            <DataGridTextColumn Header="Month/Year" Binding="{Binding MonthYearDisplay}" Width="120"/>
                            <DataGridTextColumn Header="Amount" Binding="{Binding Amount, StringFormat=₹{0:N2}}" Width="100"/>
                            <DataGridTextColumn Header="Units" Binding="{Binding Units}" Width="80"/>
                            <DataGridTextColumn Header="Rate/Unit" Binding="{Binding UnitsRate, StringFormat=₹{0:N2}}" Width="90"/>
                            <DataGridTextColumn Header="Due Date" Binding="{Binding FormattedDueDate}" Width="100"/>
                            <DataGridTextColumn Header="Status" Binding="{Binding PaymentStatus}" Width="80"/>
                            <DataGridTextColumn Header="Paid Date" Binding="{Binding FormattedPaidDate}" Width="100"/>
                            <DataGridTemplateColumn Header="Actions" Width="120">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button Content="Edit" Tag="{Binding Id}" Click="BtnEditElectricityBill_Click"
                                                    Style="{StaticResource SecondaryButtonStyle}" Width="50" Height="25" FontSize="10" Margin="2"/>
                                            <Button Content="Delete" Tag="{Binding Id}" Click="BtnDeleteElectricityBill_Click"
                                                    Style="{StaticResource DangerButtonStyle}" Width="50" Height="25" FontSize="10" Margin="2"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- Other Expenses Tab -->
            <TabItem Header="📝 Other Expenses">
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Other Expenses Header -->
                    <Grid Grid.Row="0" Margin="0,0,0,20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Other Expenses Management" FontSize="20" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>
                            <TextBlock Text="Track stationery, events, maintenance and other school-related expenses" FontSize="12" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,5,0,0"/>
                        </StackPanel>

                        <Button Grid.Column="1" x:Name="btnAddOtherExpense" Content="+ Add New Expense"
                                Height="35" Padding="15,0" Click="BtnAddOtherExpense_Click"
                                Style="{StaticResource PrimaryButtonStyle}"/>
                    </Grid>

                    <!-- Category Filter -->
                    <Grid Grid.Row="1" Margin="0,0,0,15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="200"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="Filter by Category:" VerticalAlignment="Center" Margin="0,0,10,0" Foreground="{StaticResource TextPrimaryBrush}"/>
                        <ComboBox Grid.Column="1" x:Name="cmbCategoryFilter" SelectionChanged="CmbCategoryFilter_SelectionChanged"/>
                        <Button Grid.Column="2" x:Name="btnClearFilter" Content="Clear Filter" Margin="10,0,0,0"
                                Height="30" Click="BtnClearFilter_Click" Style="{StaticResource SecondaryButtonStyle}"/>
                    </Grid>

                    <!-- Other Expenses DataGrid -->
                    <DataGrid Grid.Row="2" x:Name="dgOtherExpenses"
                              AutoGenerateColumns="False" CanUserAddRows="False"
                              MouseDoubleClick="DgOtherExpenses_MouseDoubleClick">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Category" Binding="{Binding CategoryDisplay}" Width="120"/>
                            <DataGridTextColumn Header="Expense Type" Binding="{Binding ExpenseType}" Width="150"/>
                            <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="200"/>
                            <DataGridTextColumn Header="Amount" Binding="{Binding Amount, StringFormat=₹{0:N2}}" Width="100"/>
                            <DataGridTextColumn Header="Date" Binding="{Binding FormattedExpenseDate}" Width="100"/>
                            <DataGridTextColumn Header="Vendor" Binding="{Binding VendorName}" Width="120"/>
                            <DataGridTextColumn Header="Invoice #" Binding="{Binding InvoiceNumber}" Width="100"/>
                            <DataGridTemplateColumn Header="Actions" Width="120">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button Content="Edit" Tag="{Binding Id}" Click="BtnEditOtherExpense_Click"
                                                    Style="{StaticResource SecondaryButtonStyle}" Width="50" Height="25" FontSize="10" Margin="2"/>
                                            <Button Content="Delete" Tag="{Binding Id}" Click="BtnDeleteOtherExpense_Click"
                                                    Style="{StaticResource DangerButtonStyle}" Width="50" Height="25" FontSize="10" Margin="2"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- Expense Analytics Tab -->
            <TabItem Header="📊 Expense Analytics">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="20">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Dashboard Header -->
                        <StackPanel Grid.Row="0" Margin="0,0,0,20">
                            <TextBlock Text="Expense Analytics Dashboard" FontSize="20" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>
                            <TextBlock Text="Comprehensive view of all school expenses including transport, fees, salaries and utilities" FontSize="12" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,5,0,0"/>
                        </StackPanel>

                        <!-- View Selection -->
                        <Grid Grid.Row="1" Margin="0,0,0,20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Orientation="Horizontal">
                                <TextBlock Text="View:" VerticalAlignment="Center" Margin="0,0,10,0" Foreground="{StaticResource TextPrimaryBrush}"/>
                                <RadioButton x:Name="rbMonthly" Content="Monthly" IsChecked="True" Margin="0,0,15,0"
                                             Checked="ViewRadioButton_Checked"/>
                                <RadioButton x:Name="rbYearly" Content="Yearly" Margin="0,0,15,0"
                                             Checked="ViewRadioButton_Checked"/>
                                <RadioButton x:Name="rbOverall" Content="Overall"
                                             Checked="ViewRadioButton_Checked"/>
                            </StackPanel>

                            <Button Grid.Column="2" x:Name="btnRefreshDashboard" Content="🔄 Refresh"
                                    Height="30" Click="BtnRefreshDashboard_Click" Style="{StaticResource SecondaryButtonStyle}"/>
                        </Grid>

                        <!-- Summary Cards -->
                        <UniformGrid Grid.Row="2" Columns="4" Margin="0,0,0,20">
                            <!-- Electricity Expenses Card -->
                            <Border Background="{StaticResource SurfaceBrush}" CornerRadius="8" Padding="15" Margin="5"
                                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
                                <StackPanel>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Border Grid.Column="0" Background="#FF9800" Width="50" Height="50" CornerRadius="25" Margin="0,0,10,0">
                                            <TextBlock Text="⚡" FontSize="26" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White"/>
                                        </Border>
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="Electricity" FontSize="14" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>
                                            <TextBlock x:Name="txtElectricityTotal" Text="₹0.00" FontSize="18" FontWeight="Bold" Foreground="#FF9800"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- Other Expenses Card -->
                            <Border Background="{StaticResource SurfaceBrush}" CornerRadius="8" Padding="15" Margin="5"
                                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
                                <StackPanel>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Border Grid.Column="0" Background="#9C27B0" Width="50" Height="50" CornerRadius="25" Margin="0,0,10,0">
                                            <TextBlock Text="📝" FontSize="26" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White"/>
                                        </Border>
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="Other Expenses" FontSize="14" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>
                                            <TextBlock x:Name="txtOtherExpensesTotal" Text="₹0.00" FontSize="18" FontWeight="Bold" Foreground="#9C27B0"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- Transport Expenses Card -->
                            <Border Background="{StaticResource SurfaceBrush}" CornerRadius="8" Padding="15" Margin="5"
                                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
                                <StackPanel>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Border Grid.Column="0" Background="#2196F3" Width="50" Height="50" CornerRadius="25" Margin="0,0,10,0">
                                            <TextBlock Text="🚌" FontSize="26" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White"/>
                                        </Border>
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="Transport" FontSize="14" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>
                                            <TextBlock x:Name="txtTransportTotal" Text="₹0.00" FontSize="18" FontWeight="Bold" Foreground="#2196F3"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- Staff Salaries Card -->
                            <Border Background="{StaticResource SurfaceBrush}" CornerRadius="8" Padding="15" Margin="5"
                                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
                                <StackPanel>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Border Grid.Column="0" Background="#4CAF50" Width="50" Height="50" CornerRadius="25" Margin="0,0,10,0">
                                            <TextBlock Text="👥" FontSize="26" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White"/>
                                        </Border>
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="Staff Salaries" FontSize="14" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>
                                            <TextBlock x:Name="txtSalariesTotal" Text="₹0.00" FontSize="18" FontWeight="Bold" Foreground="#4CAF50"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </UniformGrid>

                        <!-- Total Income vs Expenses -->
                        <Border Grid.Row="3" Background="{StaticResource SurfaceBrush}" CornerRadius="8" Padding="15" Margin="0,0,0,20"
                                BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                    <TextBlock Text="Total Income" FontSize="16" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}" HorizontalAlignment="Center"/>
                                    <TextBlock x:Name="txtTotalIncome" Text="₹0.00" FontSize="24" FontWeight="Bold" Foreground="#4CAF50" HorizontalAlignment="Center" Margin="0,10,0,0"/>
                                    <TextBlock Text="(Student Fees)" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                    <TextBlock Text="Total Expenses" FontSize="16" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}" HorizontalAlignment="Center"/>
                                    <TextBlock x:Name="txtTotalExpenses" Text="₹0.00" FontSize="24" FontWeight="Bold" Foreground="#F44336" HorizontalAlignment="Center" Margin="0,10,0,0"/>
                                    <TextBlock Text="(All Categories)" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                </StackPanel>

                                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                    <TextBlock Text="Net Balance" FontSize="16" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}" HorizontalAlignment="Center"/>
                                    <TextBlock x:Name="txtNetBalance" Text="₹0.00" FontSize="24" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,10,0,0"/>
                                    <TextBlock Text="(Income - Expenses)" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Category Breakdown -->
                        <Border Grid.Row="4" Background="{StaticResource SurfaceBrush}" CornerRadius="8" Padding="15"
                                BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Expense Breakdown by Category" FontSize="16" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,15"/>
                                <DataGrid x:Name="dgCategoryBreakdown" AutoGenerateColumns="False" CanUserAddRows="False"
                                          Height="200">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="*"/>
                                        <DataGridTextColumn Header="Amount" Binding="{Binding Amount, StringFormat=₹{0:N2}}" Width="120"/>
                                        <DataGridTextColumn Header="Percentage" Binding="{Binding Percentage, StringFormat={}{0:F1}%}" Width="100"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </Border>
                    </Grid>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <!-- Status Bar -->
        <StatusBar Grid.Row="2" Height="25" Background="{StaticResource SecondaryDarkBrush}">
            <StatusBarItem>
                <TextBlock x:Name="lblStatus" Text="Ready" Foreground="{StaticResource TextOnPrimaryBrush}"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>