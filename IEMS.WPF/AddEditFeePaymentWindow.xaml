<Window x:Class="IEMS.WPF.AddEditFeePaymentWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Record Fee Payment" Height="650" Width="500"
        WindowStartupLocation="CenterScreen" ResizeMode="NoResize">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Background="#2ECC71" Orientation="Horizontal" Height="50">
            <TextBlock Text="ðŸ’°" FontSize="24" Margin="15,0" VerticalAlignment="Center"/>
            <TextBlock Text="Record Fee Payment" FontSize="18" FontWeight="Bold"
                       Foreground="White" VerticalAlignment="Center"/>
        </StackPanel>

        <!-- Form Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="20">
                <!-- Validation Message -->
                <TextBlock x:Name="lblValidation" Foreground="Red" FontWeight="Bold"
                           Visibility="Collapsed" Margin="0,0,0,10"/>

                <!-- Student Selection -->
                <Label Content="Select Student *" FontWeight="Bold" Margin="0,5"/>
                <ComboBox x:Name="cmbStudent" Height="30"
                          DisplayMemberPath="DisplayName"
                          SelectedValuePath="Id"
                          SelectionChanged="CmbStudent_SelectionChanged"/>

                <!-- Student Details Display -->
                <Border x:Name="borderStudentInfo" BorderBrush="#3498DB" BorderThickness="1"
                        CornerRadius="3" Margin="0,10" Padding="10" Visibility="Collapsed">
                    <StackPanel>
                        <TextBlock x:Name="txtStudentInfo" FontSize="12" TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <!-- Academic Year -->
                <Label Content="Academic Year *" FontWeight="Bold" Margin="0,5"/>
                <ComboBox x:Name="cmbAcademicYear" Height="30">
                    <ComboBoxItem Content="2024-25" IsSelected="True"/>
                    <ComboBoxItem Content="2025-26"/>
                    <ComboBoxItem Content="2023-24"/>
                </ComboBox>

                <!-- Fee Type -->
                <Label Content="Fee Type *" FontWeight="Bold" Margin="0,5"/>
                <ComboBox x:Name="cmbFeeType" Height="30" SelectionChanged="CmbFeeType_SelectionChanged"/>

                <!-- Fee Structure Display -->
                <Border x:Name="borderFeeInfo" BorderBrush="#F39C12" BorderThickness="1"
                        CornerRadius="3" Margin="0,10" Padding="10" Visibility="Collapsed">
                    <StackPanel>
                        <TextBlock x:Name="txtFeeStructureInfo" FontSize="12" TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <!-- Payment Method -->
                <Label Content="Payment Method *" FontWeight="Bold" Margin="0,5"/>
                <ComboBox x:Name="cmbPaymentMethod" Height="30" SelectionChanged="CmbPaymentMethod_SelectionChanged"/>

                <!-- Transaction Details (Dynamic based on payment method) -->
                <StackPanel x:Name="pnlTransactionDetails" Visibility="Collapsed">
                    <Label x:Name="lblTransactionField" Content="Transaction ID" FontWeight="Bold" Margin="0,5"/>
                    <TextBox x:Name="txtTransactionId" Height="30"/>

                    <StackPanel x:Name="pnlBankDetails" Visibility="Collapsed">
                        <Label Content="Bank Name" FontWeight="Bold" Margin="0,5"/>
                        <TextBox x:Name="txtBankName" Height="30"/>
                    </StackPanel>
                </StackPanel>

                <!-- Amount Section -->
                <Grid Margin="0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Margin="0,0,5,0">
                        <Label Content="Amount to Pay *" FontWeight="Bold"/>
                        <TextBox x:Name="txtAmount" Height="30" TextChanged="TxtAmount_TextChanged"/>
                        <TextBlock x:Name="txtAmountInWords" FontSize="10" Foreground="Gray"
                                   TextWrapping="Wrap" Margin="0,2"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Margin="5,0,0,0">
                        <Label Content="Late Fee (if any)" FontWeight="Bold"/>
                        <TextBox x:Name="txtLateFee" Height="30" Text="0" TextChanged="RecalculateTotals"/>
                    </StackPanel>
                </Grid>

                <Grid Margin="0,5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Margin="0,0,5,0">
                        <Label Content="Discount (if any)" FontWeight="Bold"/>
                        <TextBox x:Name="txtDiscount" Height="30" Text="0" TextChanged="RecalculateTotals"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Margin="5,0,0,0">
                        <Label Content="Installment No." FontWeight="Bold"/>
                        <TextBox x:Name="txtInstallmentNumber" Height="30"/>
                    </StackPanel>
                </Grid>

                <!-- Next Due Date -->
                <Label Content="Next Due Date (if applicable)" FontWeight="Bold" Margin="0,5"/>
                <DatePicker x:Name="dpNextDueDate" Height="30"/>

                <!-- Payment Notes -->
                <Label Content="Payment Notes" FontWeight="Bold" Margin="0,5"/>
                <TextBox x:Name="txtPaymentNotes" Height="60" TextWrapping="Wrap"
                         AcceptsReturn="True" VerticalScrollBarVisibility="Auto"/>

                <!-- Summary Display -->
                <Border BorderBrush="#2ECC71" BorderThickness="2" CornerRadius="3"
                        Margin="0,10" Padding="10" Background="#E8F8F5">
                    <StackPanel>
                        <TextBlock Text="Payment Summary" FontWeight="Bold" FontSize="14" Margin="0,0,0,5"/>
                        <TextBlock x:Name="txtPaymentSummary" FontSize="12" TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="10">
            <Button x:Name="btnSave" Content="Record Payment" Width="120" Height="35"
                    Margin="5" Click="BtnSave_Click"
                    Background="#2ECC71" Foreground="White" BorderThickness="0"/>
            <Button x:Name="btnCancel" Content="Cancel" Width="100" Height="35"
                    Margin="5" Click="BtnCancel_Click"
                    Background="#95A5A6" Foreground="White" BorderThickness="0"/>
        </StackPanel>
    </Grid>
</Window>