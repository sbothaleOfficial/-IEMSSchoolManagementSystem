<Window x:Class="IEMS.WPF.StudentsManagementWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:IEMS.WPF.Controls"
        Title="Students Management" Height="700" Width="1600"
        WindowStartupLocation="CenterScreen">
    <Grid>
        <!-- Main Content Grid -->
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Background="{StaticResource PrimaryBrush}" Orientation="Horizontal" Height="60">
            <TextBlock Text="ðŸ‘¥" FontSize="30" Margin="20,0" VerticalAlignment="Center"/>
            <TextBlock Text="Students Management System"
                       FontSize="20" FontWeight="Bold" Foreground="{StaticResource TextOnPrimaryBrush}"
                       VerticalAlignment="Center" Margin="10,0,0,0"/>
        </StackPanel>

        <!-- Main Content -->
        <TabControl Grid.Row="1" Margin="10">
            <TabItem Header="ðŸ“Š Dashboard" FontSize="14">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="20">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Overall Statistics Cards -->
                        <TextBlock Grid.Row="0" Text="ðŸ“Š School Overview" FontSize="18" FontWeight="Bold"
                                   Margin="0,0,0,15" Foreground="{StaticResource TextPrimaryBrush}"/>

                        <UniformGrid Grid.Row="1" Columns="4" Margin="0,0,0,30">
                            <!-- Total Students Card -->
                            <Border Background="{StaticResource SuccessBrush}" CornerRadius="10" Margin="5">
                                <StackPanel Margin="20" HorizontalAlignment="Center">
                                    <TextBlock Text="ðŸ‘¥" FontSize="30" HorizontalAlignment="Center" Foreground="White"/>
                                    <TextBlock x:Name="lblTotalStudents" Text="0" FontSize="24" FontWeight="Bold"
                                               HorizontalAlignment="Center" Foreground="White"/>
                                    <TextBlock Text="Total Students" FontSize="12" HorizontalAlignment="Center" Foreground="White"/>
                                </StackPanel>
                            </Border>

                            <!-- Total Male Students Card -->
                            <Border Background="{StaticResource PrimaryBrush}" CornerRadius="10" Margin="5">
                                <StackPanel Margin="20" HorizontalAlignment="Center">
                                    <TextBlock Text="ðŸ‘¨â€ðŸŽ“" FontSize="30" HorizontalAlignment="Center" Foreground="White"/>
                                    <TextBlock x:Name="lblMaleStudents" Text="0" FontSize="24" FontWeight="Bold"
                                               HorizontalAlignment="Center" Foreground="White"/>
                                    <TextBlock Text="Male Students" FontSize="12" HorizontalAlignment="Center" Foreground="White"/>
                                </StackPanel>
                            </Border>

                            <!-- Total Female Students Card -->
                            <Border Background="#E74C3C" CornerRadius="10" Margin="5">
                                <StackPanel Margin="20" HorizontalAlignment="Center">
                                    <TextBlock Text="ðŸ‘©â€ðŸŽ“" FontSize="30" HorizontalAlignment="Center" Foreground="White"/>
                                    <TextBlock x:Name="lblFemaleStudents" Text="0" FontSize="24" FontWeight="Bold"
                                               HorizontalAlignment="Center" Foreground="White"/>
                                    <TextBlock Text="Female Students" FontSize="12" HorizontalAlignment="Center" Foreground="White"/>
                                </StackPanel>
                            </Border>

                            <!-- Total Classes Card -->
                            <Border Background="#9B59B6" CornerRadius="10" Margin="5">
                                <StackPanel Margin="20" HorizontalAlignment="Center">
                                    <TextBlock Text="ðŸ«" FontSize="30" HorizontalAlignment="Center" Foreground="White"/>
                                    <TextBlock x:Name="lblTotalClasses" Text="0" FontSize="24" FontWeight="Bold"
                                               HorizontalAlignment="Center" Foreground="White"/>
                                    <TextBlock Text="Total Classes" FontSize="12" HorizontalAlignment="Center" Foreground="White"/>
                                </StackPanel>
                            </Border>
                        </UniformGrid>

                        <!-- Class-wise Statistics -->
                        <TextBlock Grid.Row="2" Text="ðŸ« Class-wise Breakdown" FontSize="18" FontWeight="Bold"
                                   Margin="0,0,0,15" Foreground="{StaticResource TextPrimaryBrush}"/>

                        <Grid Grid.Row="3">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Class-wise Total Count -->
                            <Border Grid.Column="0" Background="{StaticResource SurfaceBrush}" CornerRadius="10"
                                    Margin="5" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
                                <StackPanel Margin="15">
                                    <TextBlock Text="ðŸ“ˆ Students per Class" FontSize="14" FontWeight="Bold"
                                               Margin="0,0,0,10" Foreground="{StaticResource TextPrimaryBrush}"/>
                                    <DataGrid x:Name="dgClassStats" AutoGenerateColumns="False" HeadersVisibility="Column"
                                              CanUserAddRows="False" CanUserDeleteRows="False" IsReadOnly="True"
                                              GridLinesVisibility="Horizontal" BorderThickness="0" Background="Transparent"
                                              RowBackground="Transparent" AlternatingRowBackground="#F8F9FA">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Class" Binding="{Binding ClassName}" Width="80"/>
                                            <DataGridTextColumn Header="Total" Binding="{Binding TotalStudents}" Width="60"/>
                                            <DataGridTextColumn Header="Male" Binding="{Binding MaleStudents}" Width="60"/>
                                            <DataGridTextColumn Header="Female" Binding="{Binding FemaleStudents}" Width="60"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>

                            <!-- Additional Statistics -->
                            <Border Grid.Column="1" Background="{StaticResource SurfaceBrush}" CornerRadius="10"
                                    Margin="5" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
                                <StackPanel Margin="15">
                                    <TextBlock Text="ðŸ“‹ Additional Statistics" FontSize="14" FontWeight="Bold"
                                               Margin="0,0,0,15" Foreground="{StaticResource TextPrimaryBrush}"/>

                                    <!-- BPL Students -->
                                    <StackPanel Orientation="Horizontal" Margin="0,5">
                                        <TextBlock Text="ðŸ  BPL Students:" Width="120" Foreground="{StaticResource TextPrimaryBrush}"/>
                                        <TextBlock x:Name="lblBPLStudents" Text="0" FontWeight="Bold" Foreground="{StaticResource SuccessBrush}"/>
                                    </StackPanel>

                                    <!-- Semi-English Students -->
                                    <StackPanel Orientation="Horizontal" Margin="0,5">
                                        <TextBlock Text="ðŸŒ Semi-English:" Width="120" Foreground="{StaticResource TextPrimaryBrush}"/>
                                        <TextBlock x:Name="lblSemiEnglishStudents" Text="0" FontWeight="Bold" Foreground="{StaticResource PrimaryBrush}"/>
                                    </StackPanel>

                                    <!-- Religion wise breakdown -->
                                    <Separator Margin="0,15"/>
                                    <TextBlock Text="ðŸ•‰ï¸ Religion-wise Breakdown" FontSize="12" FontWeight="Bold"
                                               Margin="0,0,0,10" Foreground="{StaticResource TextPrimaryBrush}"/>
                                    <DataGrid x:Name="dgReligionStats" AutoGenerateColumns="False" HeadersVisibility="Column"
                                              CanUserAddRows="False" CanUserDeleteRows="False" IsReadOnly="True"
                                              GridLinesVisibility="Horizontal" BorderThickness="0" Background="Transparent"
                                              RowBackground="Transparent" AlternatingRowBackground="#F8F9FA">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Religion" Binding="{Binding Religion}" Width="100"/>
                                            <DataGridTextColumn Header="Count" Binding="{Binding Count}" Width="60"/>
                                            <DataGridTextColumn Header="Male" Binding="{Binding MaleCount}" Width="50"/>
                                            <DataGridTextColumn Header="Female" Binding="{Binding FemaleCount}" Width="50"/>
                                        </DataGrid.Columns>
                                    </DataGrid>

                                    <!-- Caste Category breakdown -->
                                    <Separator Margin="0,15"/>
                                    <TextBlock Text="ðŸ“Š Caste Category Breakdown" FontSize="12" FontWeight="Bold"
                                               Margin="0,0,0,10" Foreground="{StaticResource TextPrimaryBrush}"/>
                                    <DataGrid x:Name="dgCasteStats" AutoGenerateColumns="False" HeadersVisibility="Column"
                                              CanUserAddRows="False" CanUserDeleteRows="False" IsReadOnly="True"
                                              GridLinesVisibility="Horizontal" BorderThickness="0" Background="Transparent"
                                              RowBackground="Transparent" AlternatingRowBackground="#F8F9FA">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="100"/>
                                            <DataGridTextColumn Header="Count" Binding="{Binding Count}" Width="60"/>
                                            <DataGridTextColumn Header="Male" Binding="{Binding MaleCount}" Width="50"/>
                                            <DataGridTextColumn Header="Female" Binding="{Binding FemaleCount}" Width="50"/>
                                        </DataGrid.Columns>
                                    </DataGrid>

                                    <!-- City/Village breakdown -->
                                    <Separator Margin="0,15"/>
                                    <TextBlock Text="ðŸ˜ï¸ City/Village Breakdown" FontSize="12" FontWeight="Bold"
                                               Margin="0,0,0,10" Foreground="{StaticResource TextPrimaryBrush}"/>
                                    <DataGrid x:Name="dgCityVillageStats" AutoGenerateColumns="False" HeadersVisibility="Column"
                                              CanUserAddRows="False" CanUserDeleteRows="False" IsReadOnly="True"
                                              GridLinesVisibility="Horizontal" BorderThickness="0" Background="Transparent"
                                              RowBackground="Transparent" AlternatingRowBackground="#F8F9FA">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="City/Village" Binding="{Binding CityVillage}" Width="120"/>
                                            <DataGridTextColumn Header="Count" Binding="{Binding Count}" Width="60"/>
                                            <DataGridTextColumn Header="Male" Binding="{Binding MaleCount}" Width="50"/>
                                            <DataGridTextColumn Header="Female" Binding="{Binding FemaleCount}" Width="50"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </Grid>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="ðŸ“š Students" FontSize="14">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,10,0,10">
                        <Button x:Name="btnAddStudent" Content="Add Student" Width="120" Height="35" Margin="0,0,10,0"
                                Click="BtnAddStudent_Click" Style="{StaticResource SuccessButtonStyle}"/>
                        <Button x:Name="btnEditStudent" Content="Edit Student" Width="120" Height="35" Margin="0,0,10,0"
                                Click="BtnEditStudent_Click" Style="{StaticResource PrimaryButtonStyle}"/>
                        <Button x:Name="btnDeleteStudent" Content="Delete Student" Width="130" Height="35" Margin="0,0,10,0"
                                Click="BtnDeleteStudent_Click" Style="{StaticResource DangerButtonStyle}"/>
                        <Button x:Name="btnRefreshStudents" Content="Refresh" Width="100" Height="35" Margin="0,0,10,0"
                                Click="BtnRefreshStudents_Click" Style="{StaticResource SecondaryButtonStyle}"/>
                        <Separator Width="20"/>
                        <TextBlock Text="Search:" VerticalAlignment="Center" Margin="10,0,5,0" Foreground="{StaticResource TextPrimaryBrush}"/>
                        <TextBox x:Name="txtSearchStudents" Width="200" Height="25" VerticalAlignment="Center"
                                 TextChanged="TxtSearchStudents_TextChanged"
                                 ToolTip="Search by name, student number, father's name, or mobile number"/>
                    </StackPanel>

                    <DataGrid x:Name="dgStudents" Grid.Row="1" AutoGenerateColumns="False"
                              CanUserAddRows="False" CanUserDeleteRows="False" IsReadOnly="True"
                              GridLinesVisibility="All" HeadersVisibility="Column" AlternatingRowBackground="{StaticResource SurfaceBrush}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Serial No" Binding="{Binding SerialNo}" Width="70"/>
                            <DataGridTextColumn Header="Standard" Binding="{Binding Standard}" Width="70"/>
                            <DataGridTextColumn Header="Division" Binding="{Binding ClassDivision}" Width="70"/>
                            <DataGridTextColumn Header="First Name" Binding="{Binding FirstName}" Width="100"/>
                            <DataGridTextColumn Header="Father's Name" Binding="{Binding FatherName}" Width="120"/>
                            <DataGridTextColumn Header="Surname" Binding="{Binding Surname}" Width="100"/>
                            <DataGridTextColumn Header="Date of Birth" Binding="{Binding FormattedDateOfBirth}" Width="90"/>
                            <DataGridTextColumn Header="Gender" Binding="{Binding Gender}" Width="70"/>
                            <DataGridTextColumn Header="Mother's Name" Binding="{Binding MotherName}" Width="120"/>
                            <DataGridTextColumn Header="Student No" Binding="{Binding StudentNumber}" Width="90"/>
                            <DataGridTextColumn Header="Admission Date" Binding="{Binding FormattedAdmissionDate}" Width="110"/>
                            <DataGridTextColumn Header="Caste Category" Binding="{Binding CasteCategory}" Width="110"/>
                            <DataGridTextColumn Header="Religion" Binding="{Binding Religion}" Width="80"/>
                            <DataGridTextColumn Header="BPL" Binding="{Binding IsBPL}" Width="50"/>
                            <DataGridTextColumn Header="Semi-English" Binding="{Binding IsSemiEnglish}" Width="100"/>
                            <DataGridTextColumn Header="Address" Binding="{Binding Address}" Width="150"/>
                            <DataGridTextColumn Header="Mobile" Binding="{Binding ParentMobileNumber}" Width="100"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <TabItem Header="ðŸ« Classes" FontSize="14">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,10,0,10">
                        <Button x:Name="btnAddClass" Content="Add Class" Width="120" Height="35" Margin="0,0,10,0"
                                Click="BtnAddClass_Click" Style="{StaticResource SuccessButtonStyle}"/>
                        <Button x:Name="btnEditClass" Content="Edit Class" Width="120" Height="35" Margin="0,0,10,0"
                                Click="BtnEditClass_Click" Style="{StaticResource PrimaryButtonStyle}"/>
                        <Button x:Name="btnDeleteClass" Content="Delete Class" Width="130" Height="35" Margin="0,0,10,0"
                                Click="BtnDeleteClass_Click" Style="{StaticResource DangerButtonStyle}"/>
                        <Button x:Name="btnRefreshClasses" Content="Refresh" Width="100" Height="35" Margin="0,0,10,0"
                                Click="BtnRefreshClasses_Click" Style="{StaticResource SecondaryButtonStyle}"/>
                        <Button x:Name="btnViewClassStudents" Content="View Students" Width="120" Height="35" Margin="10,0,10,0"
                                Click="BtnViewClassStudents_Click" Style="{StaticResource PrimaryButtonStyle}"/>
                    </StackPanel>

                    <DataGrid x:Name="dgClasses" Grid.Row="1" AutoGenerateColumns="False"
                              CanUserAddRows="False" CanUserDeleteRows="False" IsReadOnly="True"
                              GridLinesVisibility="All" HeadersVisibility="Column" AlternatingRowBackground="{StaticResource SurfaceBrush}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Class" Binding="{Binding DisplayName}" Width="150"/>
                            <DataGridTextColumn Header="Class Teacher" Binding="{Binding TeacherName}" Width="200"/>
                            <DataGridTextColumn Header="Students Enrolled" Binding="{Binding StudentCount}" Width="120"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <TabItem Header="ðŸ’° Fee Payments" FontSize="14">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,10,0,10">
                        <Button x:Name="btnAddFeePayment" Content="Record Payment" Width="120" Height="35" Margin="0,0,10,0"
                                Click="BtnAddFeePayment_Click" Style="{StaticResource SuccessButtonStyle}"/>
                        <Button x:Name="btnViewReceipt" Content="View Receipt" Width="120" Height="35" Margin="0,0,10,0"
                                Click="BtnViewReceipt_Click" Style="{StaticResource PrimaryButtonStyle}"/>
                        <Button x:Name="btnPrintReceipt" Content="Print Receipt" Width="120" Height="35" Margin="0,0,10,0"
                                Click="BtnPrintReceipt_Click" Background="#9B59B6" Foreground="White" BorderThickness="0"/>
                        <Button x:Name="btnRefreshFeePayments" Content="Refresh" Width="100" Height="35" Margin="0,0,10,0"
                                Click="BtnRefreshFeePayments_Click" Style="{StaticResource SecondaryButtonStyle}"/>
                        <Separator Width="20"/>
                        <TextBlock Text="Search:" VerticalAlignment="Center" Margin="10,0,5,0" Foreground="{StaticResource TextPrimaryBrush}"/>
                        <TextBox x:Name="txtSearchFeePayments" Width="200" Height="25" VerticalAlignment="Center"
                                 TextChanged="TxtSearchFeePayments_TextChanged"
                                 ToolTip="Search by receipt number, student name, or fee type"/>
                    </StackPanel>

                    <DataGrid x:Name="dgFeePayments" Grid.Row="1" AutoGenerateColumns="False"
                              CanUserAddRows="False" CanUserDeleteRows="False" IsReadOnly="True"
                              GridLinesVisibility="All" HeadersVisibility="Column" AlternatingRowBackground="{StaticResource SurfaceBrush}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Receipt No" Binding="{Binding ReceiptNumber}" Width="100"/>
                            <DataGridTextColumn Header="Student Name" Binding="{Binding StudentName}" Width="150"/>
                            <DataGridTextColumn Header="Class" Binding="{Binding ClassName}" Width="100"/>
                            <DataGridTextColumn Header="Fee Type" Binding="{Binding FeeTypeDisplay}" Width="100"/>
                            <DataGridTextColumn Header="Amount Paid" Binding="{Binding AmountPaidFormatted}" Width="100"/>
                            <DataGridTextColumn Header="Payment Method" Binding="{Binding PaymentMethodDisplay}" Width="120"/>
                            <DataGridTextColumn Header="Payment Date" Binding="{Binding PaymentDateFormatted}" Width="100"/>
                            <DataGridTextColumn Header="Remaining Balance" Binding="{Binding RemainingBalanceFormatted}" Width="120"/>
                            <DataGridTextColumn Header="Academic Year" Binding="{Binding AcademicYear}" Width="100"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <TabItem Header="ðŸ“œ Bonafide" FontSize="14">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,10,0,10">
                        <Button x:Name="btnGenerateBonafide" Content="Generate Certificate" Width="150" Height="35" Margin="0,0,10,0"
                                Click="BtnGenerateBonafide_Click" Style="{StaticResource SuccessButtonStyle}"/>
                        <Button x:Name="btnRefreshBonafide" Content="Refresh" Width="100" Height="35" Margin="0,0,10,0"
                                Click="BtnRefreshBonafide_Click" Style="{StaticResource SecondaryButtonStyle}"/>
                        <Separator Width="20"/>
                        <TextBlock Text="Search:" VerticalAlignment="Center" Margin="10,0,5,0" Foreground="{StaticResource TextPrimaryBrush}"/>
                        <TextBox x:Name="txtSearchBonafide" Width="200" Height="25" VerticalAlignment="Center"
                                 TextChanged="TxtSearchBonafide_TextChanged"
                                 ToolTip="Search by student name, student number, or class"/>
                    </StackPanel>

                    <DataGrid x:Name="dgBonafideStudents" Grid.Row="1" AutoGenerateColumns="False"
                              CanUserAddRows="False" CanUserDeleteRows="False" IsReadOnly="True"
                              GridLinesVisibility="All" HeadersVisibility="Column" AlternatingRowBackground="{StaticResource SurfaceBrush}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Student No" Binding="{Binding StudentNumber}" Width="100"/>
                            <DataGridTextColumn Header="Full Name" Binding="{Binding FullName}" Width="200"/>
                            <DataGridTextColumn Header="Father's Name" Binding="{Binding FatherName}" Width="150"/>
                            <DataGridTextColumn Header="Mother's Name" Binding="{Binding MotherName}" Width="150"/>
                            <DataGridTextColumn Header="Class" Binding="{Binding ClassWithDivision}" Width="100"/>
                            <DataGridTextColumn Header="Date of Birth" Binding="{Binding FormattedDateOfBirth}" Width="100"/>
                            <DataGridTextColumn Header="Admission Date" Binding="{Binding FormattedAdmissionDate}" Width="110"/>
                            <DataGridTextColumn Header="Caste" Binding="{Binding CasteCategory}" Width="100"/>
                            <DataGridTextColumn Header="Religion" Binding="{Binding Religion}" Width="100"/>
                            <DataGridTextColumn Header="Gender" Binding="{Binding Gender}" Width="80"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- Status Bar -->
        <StatusBar Grid.Row="2" Height="25" Background="#34495E">
            <StatusBarItem>
                <TextBlock x:Name="lblStatus" Text="Ready" Foreground="White"/>
            </StatusBarItem>
        </StatusBar>

        <!-- Loading Overlay -->
        <controls:LoadingOverlay x:Name="loadingOverlay" IsLoading="False" LoadingMessage="Loading students..." Panel.ZIndex="999"/>

        <!-- Toast Notifications -->
        <controls:ToastNotification x:Name="toastNotification" Panel.ZIndex="1000"/>
    </Grid>
</Window>