{
  "permissions": {
    "allow": [
      "Bash(git commit -m \"$(cat <<''EOF''\nFix critical Backup and Restore Management bugs (15 issues resolved)\n\nCRITICAL FIXES (7):\n1. FIXED: Database path inconsistency between BackupService and UI\n   - Changed from Directory.GetCurrentDirectory() to AppDomain.CurrentDomain.BaseDirectory\n   - Ensures backup/restore operations target the correct database file\n   Location: BackupService.cs:28, BackupRestoreWindow.xaml.cs:38\n\n2. FIXED: WAL/SHM file backup failures now properly detected\n   - Added try-catch with cleanup on WAL/SHM copy failure\n   - Prevents creation of corrupted/incomplete backups\n   Location: BackupService.cs:108-126\n\n3. FIXED: WAL/SHM file restore failures now properly detected\n   - Wraps WAL/SHM restore in try-catch to fail entire restore on error\n   - Prevents database inconsistency after partial restore\n   Location: BackupService.cs:242-253\n\n4. FIXED: BackupService now receives IServiceProvider via DI\n   - Enables proper database connection closure during backup/restore\n   - Prevents \"database is locked\" errors\n   Location: BackupRestoreWindow.xaml.cs:25\n\n5. FIXED: Async void timer callback replaced with safe wrapper\n   - Prevents unhandled exceptions from crashing the application\n   - Added proper exception logging in automatic backup service\n   Location: AutomaticBackupService.cs:33, 46-67\n\n6. FIXED: Force restore now ALWAYS creates safety backup\n   - Removed skipSafetyBackup parameter from force restore path\n   - Prevents complete data loss if restore fails\n   Location: BackupRestoreWindow.xaml.cs:412, 451\n\n7. FIXED: Monthly backup scheduling logic corrected\n   - Changed from \"haven't run this month\"\" to \"\"haven't run today\"\n   - Prevents running 24+ backups per day instead of 1 per month\n   Location: AutomaticBackupService.cs:192-195\n\nHIGH PRIORITY FIXES (4):\n8. FIXED: Weekly backup now runs on scheduled day consistently\n   - Changed from \"7+ days since last backup\" to \"scheduled day of week\"\n   - Ensures backups run every Friday (or configured day) as expected\n   Location: AutomaticBackupService.cs:163-169\n\n9. FIXED: GetLastFullBackupAsync return type now nullable\n   - Changed from Task<BackupInfo> to Task<BackupInfo?>\n   - Prevents NullReferenceException when no backups exist\n   Location: BackupService.cs:764\n\n10. FIXED: Path.GetDirectoryName null checks added\n    - Checks for null before calling Directory.CreateDirectory\n    - Prevents ArgumentNullException on certain path configurations\n    Location: BackupService.cs:72-74, 82-84\n\n11. FIXED: Enum.Parse replaced with Enum.TryParse for safety\n    - Uses TryParse with fallback value (Friday)\n    - Prevents application crash from invalid enum values\n    Location: BackupRestoreWindow.xaml.cs:454-458\n\nMEDIUM PRIORITY FIXES (4):\n12. FIXED: Improved time difference display in restore warnings\n    - Shows hours for recent backups (<24h), days for older\n    - Better user experience with accurate backup age information\n    Location: BackupService.cs:227-239, BackupRestoreWindow.xaml.cs:331-343\n\n13. FIXED: Upgraded checksums from MD5 to SHA256\n    - Better security and collision resistance\n    - Follows modern best practices for integrity checking\n    Location: BackupService.cs:567\n\n14. FIXED: Application restart failure now properly handled\n    - Shows manual restart instructions if automatic restart fails\n    - User is informed instead of being left with broken application\n    Location: BackupRestoreWindow.xaml.cs:401-438, 454-495\n\n15. FIXED: Orphaned WAL/SHM files cleanup with proper error logging\n    - Tracks deletion success for all files (main, WAL, SHM)\n    - Only removes from metadata if ALL files successfully deleted\n    Location: BackupService.cs:832-880\n\nAll fixes tested and verified. Build succeeds with zero errors (only pre-existing warnings).\n\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>\nEOF\n)\")"
    ],
    "deny": [],
    "ask": []
  }
}
